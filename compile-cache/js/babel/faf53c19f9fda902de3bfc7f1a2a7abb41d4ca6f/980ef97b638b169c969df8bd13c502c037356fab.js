"use babel";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = {
  config: {
    execPath: {
      type: "string",
      "default": "/usr/bin/g++"
    },
    gccIncludePaths: {
      type: "string",
      "default": " "
    },
    gccSuppressWarnings: {
      type: "boolean",
      "default": false
    },
    gccDefaultCFlags: {
      type: "string",
      "default": "-Wall"
    },
    gccDefaultCppFlags: {
      type: "string",
      "default": "-Wall -std=c++11"
    },
    gccErrorLimit: {
      type: "integer",
      "default": 0
    }
  },

  activate: function activate() {
    if (!atom.packages.getLoadedPackages("linter")) {
      atom.notifications.addError("Linter package not found.", {
        detail: "Please install the `linter` package in your Settings view."
      });
    }
  },

  provideLinter: function provideLinter() {
    var helpers = require("atom-linter");
    var regex = "(?<file>.+):(?<line>\\d+):(?<col>\\d+):\\s*\\w*\\s*(?<type>(error|warning|note)):\\s*(?<message>.*)";

    // Read configuration data from JSON file .gcc-config.json
    // in project root
    return {
      grammarScopes: ["source.c", "source.cpp"],
      scope: "file",
      lintOnFly: false,
      lint: function lint(activeEditor) {
        config = require("./config");
        var path = require('path');
        settings = config.settings();
        var file = activeEditor.getPath();
        var cwd = atom.project.getPaths()[0];
        if (!cwd) {
          editor = atom.workspace.getActivePaneItem();
          if (editor) {
            file = editor.buffer.file;
            if (file) {
              cwd = file.getParent().getPath();
            }
          }
        }
        command = settings.execPath;

        // Expand path if necessary
        if (command.substring(0, 1) == ".") {
          command = path.join(cwd, command);
        }

        args = [];

        if (activeEditor.getGrammar().name === "C++") {
          s = settings.gccDefaultCppFlags;
          tempargs = s.split(" ");
          args = args.concat(tempargs);
        } else if (activeEditor.getGrammar().name === "C") {
          s = settings.gccDefaultCFlags;
          tempargs = s.split(" ");
          args = args.concat(tempargs);
        }

        args.push("-fmax-errors=" + settings.gccErrorLimit);
        if (settings.gccSuppressWarnings) {
          args.push("-w");
        }

        var s = settings.gccIncludePaths;
        s = s.trim();
        if (s.length != 0) {
          tempargs = s.split(",");
          tempargs.forEach(function (entry) {
            entry = entry.trim();
            if (entry.length != 0) {
              if (entry.substring(0, 1) == ".") {
                entry = path.join(cwd, entry);
              }
              item = "-I" + entry;
              args.push(item);
            }
          });
        }

        args.push(file);

        full_command = "linter-gcc: " + command;
        args.forEach(function (entry) {
          full_command = full_command + " " + entry;
        });

        console.log(full_command);
        return helpers.exec(command, args, { stream: "stderr" }).then(function (output) {
          return helpers.parse(output, regex);
        });
      }
    };
  }
};
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FsZW56Ly5hdG9tL3BhY2thZ2VzL2xpbnRlci1nY2MvbGliL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7OztxQkFFRztBQUNiLFFBQU0sRUFBRTtBQUNOLFlBQVEsRUFBRTtBQUNSLFVBQUksRUFBRSxRQUFRO0FBQ2QsaUJBQVMsY0FBYztLQUN4QjtBQUNELG1CQUFlLEVBQUU7QUFDZixVQUFJLEVBQUUsUUFBUTtBQUNkLGlCQUFTLEdBQUc7S0FDYjtBQUNELHVCQUFtQixFQUFFO0FBQ25CLFVBQUksRUFBRSxTQUFTO0FBQ2YsaUJBQVMsS0FBSztLQUNmO0FBQ0Qsb0JBQWdCLEVBQUU7QUFDaEIsVUFBSSxFQUFFLFFBQVE7QUFDZCxpQkFBUyxPQUFPO0tBQ2pCO0FBQ0Qsc0JBQWtCLEVBQUU7QUFDbEIsVUFBSSxFQUFFLFFBQVE7QUFDZCxpQkFBUyxrQkFBa0I7S0FDNUI7QUFDRCxpQkFBYSxFQUFFO0FBQ2IsVUFBSSxFQUFFLFNBQVM7QUFDZixpQkFBUyxDQUFDO0tBQ1g7R0FDRjs7QUFFRCxVQUFRLEVBQUUsb0JBQU07QUFDZCxRQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsRUFBRTtBQUM3QyxVQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FDekIsMkJBQTJCLEVBQzNCO0FBQ0UsY0FBTSxFQUFFLDREQUE0RDtPQUNyRSxDQUNGLENBQUM7S0FDSDtHQUNGOztBQUVELGVBQWEsRUFBRSx5QkFBTTtBQUNuQixRQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdkMsUUFBTSxLQUFLLEdBQUcscUdBQXFHLENBQUM7Ozs7QUFJcEgsV0FBTztBQUNMLG1CQUFhLEVBQUUsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDO0FBQ3pDLFdBQUssRUFBRSxNQUFNO0FBQ2IsZUFBUyxFQUFFLEtBQUs7QUFDaEIsVUFBSSxFQUFFLGNBQUMsWUFB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QUMsQ0FBQzs7QUFFaEIsb0JBQVksR0FBRyxjQUFjLEdBQUcsT0FBTyxDQUFDO0FBQ3hDLFlBQUksQ0FBQyxPQUFPLENBQUMsVUFBUyxLQUFLLEVBQUM7QUFDeEIsc0JBQVksR0FBRyxZQUFZLEdBQUcsR0FBRyxHQUFHLEtBQUssQ0FBQztTQUM3QyxDQUFDLENBQUM7O0FBRUgsZUFBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUMxQixlQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLE1BQU07aUJBQ2hFLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQztTQUFBLENBQzdCLENBQUM7T0FDSDtLQUNGLENBQUM7R0FDSDtDQUNGIiwiZmlsZSI6Ii9ob21lL2FsZW56Ly5hdG9tL3BhY2thZ2VzL2xpbnRlci1nY2MvbGliL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBiYWJlbFwiO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGNvbmZpZzoge1xuICAgIGV4ZWNQYXRoOiB7XG4gICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgZGVmYXVsdDogXCIvdXNyL2Jpbi9nKytcIlxuICAgIH0sXG4gICAgZ2NjSW5jbHVkZVBhdGhzOiB7XG4gICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgZGVmYXVsdDogXCIgXCJcbiAgICB9LFxuICAgIGdjY1N1cHByZXNzV2FybmluZ3M6IHtcbiAgICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgICAgZGVmYXVsdDogZmFsc2VcbiAgICB9LFxuICAgIGdjY0RlZmF1bHRDRmxhZ3M6IHtcbiAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICBkZWZhdWx0OiBcIi1XYWxsXCJcbiAgICB9LFxuICAgIGdjY0RlZmF1bHRDcHBGbGFnczoge1xuICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgIGRlZmF1bHQ6IFwiLVdhbGwgLXN0ZD1jKysxMVwiXG4gICAgfSxcbiAgICBnY2NFcnJvckxpbWl0OiB7XG4gICAgICB0eXBlOiBcImludGVnZXJcIixcbiAgICAgIGRlZmF1bHQ6IDBcbiAgICB9XG4gIH0sXG5cbiAgYWN0aXZhdGU6ICgpID0+IHtcbiAgICBpZighYXRvbS5wYWNrYWdlcy5nZXRMb2FkZWRQYWNrYWdlcyhcImxpbnRlclwiKSkge1xuICAgICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFxuICAgICAgICBcIkxpbnRlciBwYWNrYWdlIG5vdCBmb3VuZC5cIixcbiAgICAgICAge1xuICAgICAgICAgIGRldGFpbDogXCJQbGVhc2UgaW5zdGFsbCB0aGUgYGxpbnRlcmAgcGFja2FnZSBpbiB5b3VyIFNldHRpbmdzIHZpZXcuXCJcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gIH0sXG5cbiAgcHJvdmlkZUxpbnRlcjogKCkgPT4ge1xuICAgIGNvbnN0IGhlbHBlcnMgPSByZXF1aXJlKFwiYXRvbS1saW50ZXJcIik7XG4gICAgY29uc3QgcmVnZXggPSBcIig/PGZpbGU+LispOig/PGxpbmU+XFxcXGQrKTooPzxjb2w+XFxcXGQrKTpcXFxccypcXFxcdypcXFxccyooPzx0eXBlPihlcnJvcnx3YXJuaW5nfG5vdGUpKTpcXFxccyooPzxtZXNzYWdlPi4qKVwiO1xuXG4gICAgLy8gUmVhZCBjb25maWd1cmF0aW9uIGRhdGEgZnJvbSBKU09OIGZpbGUgLmdjYy1jb25maWcuanNvblxuICAgIC8vIGluIHByb2plY3Qgcm9vdFxuICAgIHJldHVybiB7XG4gICAgICBncmFtbWFyU2NvcGVzOiBbXCJzb3VyY2UuY1wiLCBcInNvdXJjZS5jcHBcIl0sXG4gICAgICBzY29wZTogXCJmaWxlXCIsXG4gICAgICBsaW50T25GbHk6IGZhbHNlLFxuICAgICAgbGludDogKGFjdGl2ZUVkaXRvcikgPT4ge1xuICAgICAgICBjb25maWcgPSByZXF1aXJlKFwiLi9jb25maWdcIik7XG4gICAgICAgIHZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuICAgICAgICBzZXR0aW5ncyA9IGNvbmZpZy5zZXR0aW5ncygpO1xuICAgICAgICB2YXIgZmlsZSA9IGFjdGl2ZUVkaXRvci5nZXRQYXRoKCk7XG4gICAgICAgIHZhciBjd2QgPSBhdG9tLnByb2plY3QuZ2V0UGF0aHMoKVswXVxuICAgICAgICBpZiAoIWN3ZCkge1xuICAgICAgICAgICAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlUGFuZUl0ZW0oKTtcbiAgICAgICAgICAgIGlmIChlZGl0b3IpIHtcbiAgICAgICAgICAgICAgICBmaWxlID0gZWRpdG9yLmJ1ZmZlci5maWxlO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN3ZCA9IGZpbGUuZ2V0UGFyZW50KCkuZ2V0UGF0aCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb21tYW5kID0gc2V0dGluZ3MuZXhlY1BhdGg7XG5cbiAgICAgICAgLy8gRXhwYW5kIHBhdGggaWYgbmVjZXNzYXJ5XG4gICAgICAgIGlmIChjb21tYW5kLnN1YnN0cmluZygwLDEpID09IFwiLlwiKSB7XG4gICAgICAgICAgICBjb21tYW5kID0gcGF0aC5qb2luKGN3ZCwgY29tbWFuZCk7XG4gICAgICAgIH1cblxuICAgICAgICBhcmdzID0gW107XG5cbiAgICAgICAgaWYoYWN0aXZlRWRpdG9yLmdldEdyYW1tYXIoKS5uYW1lID09PSBcIkMrK1wiKSB7XG4gICAgICAgICAgcyA9IHNldHRpbmdzLmdjY0RlZmF1bHRDcHBGbGFncztcbiAgICAgICAgICB0ZW1wYXJncyA9IHMuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgIGFyZ3MgPSBhcmdzLmNvbmNhdCh0ZW1wYXJncyk7XG4gICAgICAgICB9IGVsc2UgaWYoYWN0aXZlRWRpdG9yLmdldEdyYW1tYXIoKS5uYW1lID09PSBcIkNcIikge1xuICAgICAgICAgIHMgPSBzZXR0aW5ncy5nY2NEZWZhdWx0Q0ZsYWdzO1xuICAgICAgICAgIHRlbXBhcmdzID0gcy5zcGxpdChcIiBcIik7XG4gICAgICAgICAgYXJncyA9IGFyZ3MuY29uY2F0KHRlbXBhcmdzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFyZ3MucHVzaChgLWZtYXgtZXJyb3JzPSR7c2V0dGluZ3MuZ2NjRXJyb3JMaW1pdH1gKTtcbiAgICAgICAgaWYoc2V0dGluZ3MuZ2NjU3VwcHJlc3NXYXJuaW5ncykge1xuICAgICAgICAgIGFyZ3MucHVzaChcIi13XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHMgPSBzZXR0aW5ncy5nY2NJbmNsdWRlUGF0aHM7XG4gICAgICAgIHMgPSBzLnRyaW0oKTtcbiAgICAgICAgaWYgKHMubGVuZ3RoICE9ICAwKSB7XG4gICAgICAgICAgICB0ZW1wYXJncyA9IHMuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgdGVtcGFyZ3MuZm9yRWFjaChmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgICAgICAgIGVudHJ5ID0gZW50cnkudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChlbnRyeS5sZW5ndGggIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuc3Vic3RyaW5nKDAsMSkgPT0gXCIuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5ID0gcGF0aC5qb2luKGN3ZCwgZW50cnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBcIi1JXCIgKyBlbnRyeTtcbiAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgYXJncy5wdXNoKGZpbGUpO1xuXG4gICAgICAgIGZ1bGxfY29tbWFuZCA9IFwibGludGVyLWdjYzogXCIgKyBjb21tYW5kO1xuICAgICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24oZW50cnkpe1xuICAgICAgICAgICAgZnVsbF9jb21tYW5kID0gZnVsbF9jb21tYW5kICsgXCIgXCIgKyBlbnRyeTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coZnVsbF9jb21tYW5kKTtcbiAgICAgICAgcmV0dXJuIGhlbHBlcnMuZXhlYyhjb21tYW5kLCBhcmdzLCB7c3RyZWFtOiBcInN0ZGVyclwifSkudGhlbihvdXRwdXQgPT5cbiAgICAgICAgICBoZWxwZXJzLnBhcnNlKG91dHB1dCwgcmVnZXgpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxufTtcbiJdfQ==
//# sourceURL=/home/alenz/.atom/packages/linter-gcc/lib/main.js
